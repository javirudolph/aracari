---
title: "Figures and Tables"
subtitle: ' '
output:
  html_document:
    toc: yes
  word_document:
    toc: yes
bibliography: ../paper/mybibfile.bib
---

```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
knitr::opts_chunk$set(message = FALSE, warning = FALSE, echo = FALSE)
```

```{r libraries}
library(ggplot2)
library(aracari)
library(cowplot)
library(dplyr)

```

```{r}
load("paper/fevd.RData")
```

```{r}
# Simulate the data for one run

set.seed(5)

data(ptpl)

# Panel 2: Table with gut retention times and the gamma distribution used for it
n <- 10000
grt_dens <- data.frame(seq = 1:n, dat = (rgamma(n, shape = 4, scale = 5) + 8))
grt_data <- data.frame(time = round(sample(grt_dens$dat, 5)), seq = 1:5)
tt <- max(grt_data$time)
ggplot(grt_dens, aes(x = dat)) +
  geom_density() + 
  geom_point(data = grt_data, aes(x = time, y = 0), color = "red") +
  #geom_point(aes(x = tt, y = 0), color = "red") +
  theme_bw() + labs(x = "Time in minutes", y = "Density") -> fig_GRT


# Panel 3: Exponential distribution used for animal movement lengths
rate <- 1/mean(ptpl$mpm)
md_dens <- data.frame(seq = 1:n, dat = rexp(n, rate = rate))
md_hist <- data.frame(md = round(sample(md_dens$dat, tt)))

ggplot(md_dens, aes(x = dat)) +
  geom_density() + 
  geom_point(data = md_hist, aes(x = md, y = 0)) +
  theme_bw() + labs(x = "Distance in meters", y = "Density") -> fig_MD


ggplot(md_hist, aes(x = md)) +
  geom_histogram() +
  theme_bw() + labs(x = "Distance in meters", y = "Count") -> fig_MD_hist

# Panel 4: Animal trajectory and locations of the seeds at the time the seeds are dropped
set.seed(5)
distance <- md_hist$md
angle <- runif(tt, min = 0, max = 360)
distx <- distance*cos(angle)
xloc <- c(0, cumsum(distx))
disty <- distance*sin(angle)
yloc <- c(0, cumsum(disty))
animalTraj <- data.frame(time = 0:tt, xloc = xloc, yloc = yloc)
seed_loc <- merge(animalTraj, grt_data, by = "time")
mean_seed_loc <- data.frame(x = mean(seed_loc$xloc), y = mean(seed_loc$yloc))

ggplot() +
  geom_path(data = animalTraj, aes(x = xloc, y = yloc), size = 1, color = "darkgrey") +
  geom_point(data = animalTraj, aes(x = xloc, y = yloc), color = "black", size = 1) +
  geom_point(data = seed_loc, aes(x = xloc, y = yloc), color = "red", size = 3) +
  geom_point(aes(x = 0, y = 0), color = "black", size = 5)+
  geom_vline(aes(xintercept=0), linetype = "dotted") + geom_hline(aes(yintercept = 0), linetype = "dotted") +
  labs(x = "x", y = "y") +
  coord_fixed() +
  theme_bw() -> fig_traj

ggplot() +
  geom_point(data = seed_loc, aes(x = xloc, y = yloc), color = "red", size = 3) +
  geom_point(aes(x = 0, y = 0), color = "black", size = 5)+
  geom_vline(aes(xintercept=0), linetype = "dotted") + geom_hline(aes(yintercept = 0), linetype = "dotted") +
  geom_segment(aes(x = seed_loc$xloc, xend = 0, y = seed_loc$yloc, yend = 0), linetype = "dashed", color = "red") +
  labs(x = "x", y = "y") +
  coord_fixed() +
  theme_bw() -> fig_disp

ggplot() +
  geom_point(data = seed_loc, aes(x = xloc, y = yloc), color = "red", size = 3) +
  geom_point(aes(x = 0, y = 0), color = "black", size = 5)+
  geom_vline(aes(xintercept=0), linetype = "dotted") + geom_hline(aes(yintercept = 0), linetype = "dotted") +
  #geom_segment(aes(x = seed_loc$xloc, xend = 0, y = seed_loc$yloc, yend = 0), linetype = "dashed", color = "red") +
  geom_point(data = mean_seed_loc, aes(x = x, y = y), color = "blue", size = 4) +
  geom_segment(aes(x = seed_loc$xloc, xend = mean_seed_loc$x, y = seed_loc$yloc, yend = mean_seed_loc$y),
               linetype = "dashed", color = "blue") +
  geom_segment(aes(x = 0, xend = mean_seed_loc$x, y = 0, yend = mean_seed_loc$y),
               linetype = "solid", color = "black") +
  labs(x = "x", y = "y") +
  coord_fixed() +
  theme_bw() -> fig_agg

```

#### Figure 1. 
Density distributions from which we sample gut retention time (GRT) and movement distance (MD). 

```{r fig.width=2.5, fig.height=4}
plot_grid(fig_GRT, fig_MD, align = "v", nrow = 2, labels = "auto", label_size = 10)
```

#### Figure 2.
Simulation example where animal movement determines location for seeds dropped. Calculations for seed dispersal distance from the parent tree and seed distance to the mean seed location as a measure of aggregation. 

```{r fig.height=2, fig.width=6}
plot_grid(fig_traj, fig_disp, fig_agg, ncol = 3, align = "h", labels = "auto", label_size = 8)
```

#### Figure 3.
Variation in Weibull distributions determined by the value of the shape parameter. The scale parameter is defined as $b=1$, and the shape parameters are defined as follows: solid line $a=\nu=1$ shows an exponential decay tail, dashed line $a=\nu=0.2$ shows a thin tail, and $a=\nu=2$ describes a fat tail with the dotted line.

```{r fig.width=3, fig.height=2.5}
# shape
exptail <- 1
thintail <- 0.2
fattail <- 2

#scale
b <- 1
kappaexp <- b^-exptail
kappathin <- b^-thintail
kappafat <- b^-fattail

ggplot(data = data.frame(x = c(0.1, 4)), aes(x)) +
  stat_function(fun = dweibull, n = 100, args = list(scale = b, shape = thintail),
                color = "black", linetype = "dashed", size = 0.8) +
  stat_function(fun = dweibull, n = 100, args = list(scale = b, shape = exptail), 
                color = "black", linetype = "dotted", size = 0.8) +
  stat_function(fun = dweibull, n = 100, args = list(scale = b, shape = fattail),
                color = "black", linetype = "solid", size = 0.8) +
  ylab("") + xlab("") +
  theme_bw()
  
``` 


## Seed dispersal distances and aggregation

```{r fig.width=6}
bind_rows(null_dispersal %>% mutate(model = "Null"), 
          indiv_dispersal %>% mutate(model = "Individual"),
          fam_dispersal %>% mutate(model = "Family")) %>% 
  mutate(model = factor(model, levels = c("Null", "Individual", "Family"))) -> dispersal_data
  
dispersal_data %>% 
  ggplot(., aes(x = dispersal, group = model)) +
  facet_wrap(~model, ncol = 3) +
  geom_histogram(aes(y = ..density..), binwidth = 50) +
  theme_bw() +
  theme(strip.background = element_rect(fill = "white")) +
  labs(y = "Density", x = "Seed dispersal (m)") -> histograms

  
null_dispersion %>% 
  mutate(model = "Null") %>% 
  bind_rows(indiv_dispersion %>% 
              mutate(model = "Individual")) %>% 
  bind_rows(fam_dispersion %>% 
              mutate(model = "Family")) %>% 
  mutate(model = factor(model, levels = c("Null", "Individual", "Family"))) -> all_disp_data
  
all_disp_data %>% 
  ggplot(., aes(y = mean_xy_dispersal, x = model)) +
  geom_boxplot() +
  theme_bw() +
  labs(y = "Mean dispersal (m)") +
  theme(axis.title.x = element_blank()) -> a


all_disp_data %>% 
  ggplot(., aes(y = seed_dispersion, x = model)) +
  geom_boxplot() +
  theme_bw() +
  labs(y = "Seed dispersion (m)") +
  theme(axis.title.x = element_blank()) -> b


boxplots <- plot_grid(a,b, ncol = 2, align = "h", labels = c("b", "c"))

plot_grid(histograms, boxplots, nrow=2, labels = c("a", ""))

# Edit redundant labels
# Fix names for axes

```

## Long distance dispersal

The mean dispersal in the boxplots is not the same as the dispersal distances before. This mean dispersal is the distance from the origin to the mean seed location in each simulation run. The mean seed location is used to calculate dispersion, as the average distance of each seed to the mean seed location, as shown in Figure 1.

```{r}
knitr::kable(dispersal_kernel_table %>% 
               rename(Long_distance = LDD))
```

## Weibull seed dispersal kernel 
```{r}
knitr::kable(weibull_table)
``` 

## Generalized Pareto tail distribution for seed dispersal


```{r}
knitr::kable(evd_table_500)
```


