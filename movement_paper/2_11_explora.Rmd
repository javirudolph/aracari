---
title: "Incorporating individual variation in animal movement models"
subtitle: "Explore data and sampling sequences"
output:
  html_document:
      toc: true
bibliography: "aracari_movement.bib"
---

# Overall description 

We have used the data collected by Kimberly Holbrook for her studies on toucan home ranges and movement patterns [@holbrook2011home]. We are starting the original raw data here. Previous work used clean data, as is shown in the `raw-data/newpointlocs.R`, by restricting the individuals to those with a minimum of 40 observations and locations collected in intervals from 15 to 90 minutes in multiples of 15 minutes. As shown in previous studies [@holbrook2007using], the distances traveled by toucans in 15-30 minutes represent the most probable distances for seed dispersal. Due to data collection constraints, locations could not be obtained every 15 minutes, and birds were sometimes located at greater time intervals. Our goal in this section is to explore the raw data again, and use a probabilistic approach that will characterize the pattern of distances moved, and use these probability distributions to later randomly sample distances from.

```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
knitr::opts_chunk$set(message = FALSE, warning = FALSE, echo = FALSE)
```

```{r}
library(aracari)
library(dplyr)
library(ggplot2)
library(tidyr)
library(purrr)
library(stringr)
library(adehabitatLT)
library(cowplot)
library(RColorBrewer)
library(gt)
library(lubridate)

theme_set(theme_bw())
```



```{r data}
# First, read in the raw tracking data
aracari_data<- read.csv("data/raw_location_data.csv")
# Time is presented as a time ID
# Each time interval is equivalent to 15 minutes
# Interval 1 == 6AM, so if we start at midnight, 6am is 24 intervals of 15 minutes each. I'm setting 6am as the start just because I don't have actual data on it, but we know they started early morning and that's what the time IDs are for in Kimberly's work.


# create a column for number of minutes equivalent to the intervals

seconds <- (24*15 + aracari_data$Time_ID * 15) * 60
td <- seconds_to_period(seconds)
aracari_data$time <- sprintf("%02d:%02d:%02d", td@hour, minute(td), second(td))

date <- paste(aracari_data$DATE, aracari_data$time)
aracari_data$date <- parse_date_time(date, "dmyHMS")
aracari_data$burst <- paste(aracari_data$Bird_ID, aracari_data$DATE, sep="_")

# Only keep the columns we need for adehabitat

aracari_data <- dplyr::select(aracari_data, Bird_ID, burst,
                           date, X_Estimate, Y_Estimate)
names(aracari_data) <- c("animal_id","burst_id", "date_time", "x", "y")
```

We can visualize the locations for each of the individuals tagged. The two separate groups represent the two locations considered: Yasuni Biosphere Reserve (upper left) and Tiputini Biodiversity Station (lower right).
```{r}
plot(aracari_data$y~aracari_data$x, 
     col = as.factor(aracari_data$animal_id), 
     pch = 16)
```
  
And the individual trajectories for each animal
```{r}
# we set the spatial coordinates for our data frame
aracari_spatial <- aracari_data
coordinates(aracari_spatial) <- c("x", "y")

#Assign a projection, I know it is UTM zone 18 because it is Ecuadorian Amazon
proj4string(aracari_spatial) <- CRS("+proj=utm +zone=18 +datum=WGS84")

# Create ltraj object for work with adehabitat
# We set typeII = TRUE because we have variable time frames, although locations were attempted every 15 minutes, this didn't always happen.
aracari_ltraj <- as.ltraj(coordinates(aracari_spatial), 
                          burst = aracari_spatial$burst_id,
                          date=aracari_spatial$date_time,
                          id=aracari_spatial$animal_id,
                          typeII = TRUE)

# We can see the locations for all the individuals tracked
plot(aracari_ltraj)
```

The trajectory for each animal measures [source](https://jamesepaterson.github.io/jamespatersonblog/02_trackingworkshop_trajectories):

* distance,
* dt (the difference in seconds between relocations),
* R2n (the squared distance between the first relocation of the trajectory and the current relocation), and
* two angle measurements (absolute and relative).

We can see the **bursts**, which describe continuous relocations during the same tracking session, which in this case is one day for four hours. Tracking periods are 4-6 daylight hours, with individual bird locations recorded every 15 minutes. Although, not always possible to get a reading every 15 minutes, some have other intervals. Tracking alternates between morning and afternoon to capture daily variation in movement.  

  -   So, there is sampling error. A success/failure of capturing a signal every 15 minutes in those 4-6hours.

```{r}
aracari_ltraj
```

### References
